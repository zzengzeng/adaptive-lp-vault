这是一份基于 **ERC-20** 代币的标准 **DeFi Staking（质押挖矿）** 需求规格说明书。该文档涵盖了业务逻辑、功能模块、技术需求及安全标准，适用于开发去中心化金融协议。

---

## 1. 项目概述

本项目的目标是开发一个去中心化智能合约协议，允许用户质押指定的 ERC-20 代币（Staking Token），并根据质押金额和时间获得奖励代币（Reward Token）。

---

## 2. 核心业务流程

* **质押（Stake）：** 用户将持有的 ERC-20 代币发送到质押合约中锁定。
* **计算收益：** 合约根据算法（如每区块奖励或固定年化利率 APY）实时计算用户的待领取奖励。
* **提取奖励（Claim）：** 用户随时领取已产生的奖励，奖励发送至用户钱包，质押本金继续保留。
* **解除质押（Unstake/Withdraw）：** 用户提取质押的本金。根据规则，可能包含锁定期限制或手续费。

---

## 3. 功能需求

### 3.1 用户端功能 (User Functions)

| 功能模块 | 详细描述 | 核心参数 |
| --- | --- | --- |
| **质押 (Stake)** | 用户授权合约扣除代币并存入质押池。 | `amount` (数量) |
| **解押 (Unstake)** | 用户撤回质押的本金。需检查是否满足锁定期要求。 | `amount` (数量) |
| **领取奖励 (Claim)** | 将当前累积的奖励代币提取到钱包。 | - |
| **复合质押 (Compound)** | 将奖励直接转化为质押本金（实现复利）。 | - |
| **查询数据 (View)** | 查看个人质押量、总质押量（TVL）、预估年化（APY）及待领取奖励。 | `address` (用户地址) |

### 3.2 管理员功能 (Admin Functions)

* **奖励注入：** 管理员向合约充资奖励代币池。
* **参数设置：** 设置/修改奖励速率（Reward Rate）、锁定期限、提取手续费。
* **紧急提款 (Emergency Withdraw)：** 在极端情况下允许用户取回本金而不计算奖励（跳过复杂逻辑）。
* **暂停/恢复：** 在发现漏洞时暂停质押或提取操作。

---

## 4. 收益算法说明

通常采用 **Synthetix 质押模型**。该模型通过一个全局变量记录每单位代币的累计收益，避免了因用户过多而导致循环计算的高昂 Gas 费。

**计算公式参考：**


其中  随时间不断累积：


---

## 5. 技术需求与安全

### 5.1 技术栈

* **智能合约：** Solidity 0.8.x+
* **开发框架：** Hardhat 或 Foundry
* **标准库：** OpenZeppelin (ERC20, SafeERC20, ReentrancyGuard, Ownable)

### 5.2 安全要点

* **防重入攻击：** 所有的提取和领取函数必须添加 `nonReentrant` 修改器。
* **精度溢出：** 使用 Solidity 0.8 自带的溢出检查，并注意精度处理（通常代币为 18 位小数）。
* **归还检查：** 使用 `SafeERC20` 处理 `transfer` 和 `transferFrom` 以防代币标准实现不一致带来的风险。
* **外部审计：** 合约上线前需经过至少一家安全公司审计。

---

## 6. 数据接口 (API/Events)

* **Event Stake:** 记录地址、金额。
* **Event Unstake:** 记录地址、金额。
* **Event RewardPaid:** 记录地址、奖励金额。

---