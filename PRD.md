
# Adaptive LP Vault (自平衡流动性金库)

## 1. 项目概述

### 1.1 项目背景

在 Uniswap（尤其是 V3）上提供流动性需要高度的活跃管理。由于价格波动，LP 的头寸经常会超出设定范围（Out of Range），导致无法赚取手续费并面临无常损失。

### 1.2 核心目标

* **自动化管理**：消除手动调整 Uniswap 头寸的复杂性。
* **收益优化**：通过再平衡逻辑，将资金动态分配至收益率最高或价格最匹配的池子。
* **标准化**：采用 **ERC-4626** 标准，确保金库份额的高组合性。

---

## 2. 核心用户 

根据系统设计，主要涉及三类交互角色：

| 角色 | 核心诉求 |
| --- | --- |
| **存款人 (Depositors)** | “我希望获得被动的 LP 敞口，而无需进行活跃的手动管理。” |
| **再平衡者 (Rebalancers)** | “我希望通过优化金库的头寸布局来赚取奖励（如手续费分成）。” |
| **管理员 (Admins)** | “我希望能够安全地配置策略参数（如手续费率、价格区间偏差等）。” |

---

## 3. 系统架构与组件

项目主要分为三个逻辑层次：

### 3.1 用户接入层 (Users)

* **资产存取**：用户（如 Alice、Bob）存入基础资产对（如 `WETH` + `USDC`）。
* **凭证发放**：金库基于 **ERC-4626** 标准铸造并分发 **Vault Shares**。

### 3.2 策略核心层 (Adaptive LP Vault)

* **Vault Shares (ERC-4626)**：负责处理存款/取款机械逻辑及份额会计。
* **TWAP Oracle Reader**：时间加权平均价格预言机。用于读取平滑的价格信号，防止闪电贷攻击或瞬时波动触发错误的再平衡。
* **再平衡逻辑 (Rebalance Logic)**：
* 接收来自 Oracle 的价格与波动率信号。
* 根据预设策略，计算资金在各流动性场地的最优分配比例。



### 3.3 流动性执行层 (Liquidity Venues)

金库根据策略将资金部署至以下场地：

* **Uniswap V2**：用于全区间流动性覆盖。
* **Uniswap V3 (0.05% / 0.30% / 1.00%)**：用于不同费率层级的集中流动性管理。

---

## 4. 技术栈与模块拆解

### 4.1 开发技能映射表

| 技术模块 | 应用场景 |
| --- |  --- |
| **ERC-4626 Vaults**  | 实现基础的存取款及份额管理机制 |
| **Uniswap V2** | V2 流动性供应与移除 |
| **Uniswap V3** | V3 头寸管理（NFT 铸造与调整） |
| **TWAP Oracles** | 获取防篡改的价格与波动率信号 |
| **Access Control** | 管理员权限与安全配置 |

### 4.2 核心流程逻辑

1. **存款**：用户将 `WETH/USDC` 注入金库，获得相应份额。
2. **监控**：系统或外部 Rebalancer 监测到价格偏离。
3. **再平衡**：
* 从旧池子撤出流动性。
* 根据 **TWAP** 信号确定的新区间重新部署资金。


4. **复利**：金库自动提取累积的手续费收益并重新注入流动性（Auto-compounding）。

---

## 5. 安全与合规性

* **防攻击机制**：强制使用 TWAP 价格，而非瞬时现货价格，以抵御闪电贷操纵。
* **管理权限**：敏感参数（如再平衡阈值）必须通过受限地址（Admin）修改。

---